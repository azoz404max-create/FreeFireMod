/* === Makefile === */
TARGET = iphone:clang:latest:14.0
INSTALL_TARGET_PROCESSES = SpringBoard

include $(THEOS)/makefiles/common.mk

TWEAK_NAME = AimbotESP
AimbotESP_FILES = Tweak.xm
AimbotESP_CFLAGS = -fobjc-arc

include $(THEOS_MAKE_PATH)/tweak.mk

/* === control === */
Package: com.example.aimbotesp
Name: Aimbot & ESP
Depends: mobilesubstrate
Version: 1.0.0
Architecture: iphoneos-arm
Description: Aimbot and ESP tweak with menu
Maintainer: You
Author: You
Section: Tweaks

/* === Tweak.xm === */
#import <UIKit/UIKit.h>

// --- Menu Panel Interface ---
@interface MenuPanel : UIView
@property (nonatomic, strong) UIImageView *backgroundView;
@property (nonatomic, strong) UISwitch *aimbotSwitch;
@property (nonatomic, strong) UISwitch *espSwitch;
@end

@implementation MenuPanel
- (instancetype)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        self.layer.cornerRadius = 15;
        self.clipsToBounds = YES;

        // 1. Background Image (User's Uploaded Image)
        self.backgroundView = [[UIImageView alloc] initWithFrame:self.bounds];
        // Ensure you place your image at this path on the device
        self.backgroundView.image = [UIImage imageWithContentsOfFile:@"/Library/Application Support/AimbotESP/background.png"];
        self.backgroundView.contentMode = UIViewContentModeScaleAspectFill;
        [self addSubview:self.backgroundView];
        
        // 2. Blur Effect
        UIVisualEffectView *blur = [[UIVisualEffectView alloc] initWithEffect:[UIBlurEffect effectWithStyle:UIBlurEffectStyleDark]];
        blur.frame = self.bounds;
        blur.alpha = 0.7; // Adjust transparency to see background
        [self addSubview:blur];
        
        // 3. Title
        UILabel *title = [[UILabel alloc] initWithFrame:CGRectMake(0, 10, frame.size.width, 30)];
        title.text = @"Aimbot & ESP Menu";
        title.textAlignment = NSTextAlignmentCenter;
        title.textColor = [UIColor whiteColor];
        title.font = [UIFont boldSystemFontOfSize:18];
        [self addSubview:title];

        // 4. Aimbot Switch
        self.aimbotSwitch = [[UISwitch alloc] initWithFrame:CGRectMake(frame.size.width - 70, 60, 50, 30)];
        [self addSubview:self.aimbotSwitch];
        
        UILabel *aimbotLabel = [[UILabel alloc] initWithFrame:CGRectMake(20, 60, 150, 30)];
        aimbotLabel.text = @"Aimbot";
        aimbotLabel.textColor = [UIColor whiteColor];
        [self addSubview:aimbotLabel];

        // 5. ESP Switch
        self.espSwitch = [[UISwitch alloc] initWithFrame:CGRectMake(frame.size.width - 70, 110, 50, 30)];
        [self addSubview:self.espSwitch];

        UILabel *espLabel = [[UILabel alloc] initWithFrame:CGRectMake(20, 110, 150, 30)];
        espLabel.text = @"ESP";
        espLabel.textColor = [UIColor whiteColor];
        [self addSubview:espLabel];
    }
    return self;
}
@end

// --- Game Logic Hooks ---

// Global state
static MenuPanel *menu = nil;
static BOOL isMenuVisible = NO;

%hook UIWindow
- (void)makeKeyAndVisible {
    %orig;
    
    // Initialize Menu
    if (!menu) {
        menu = [[MenuPanel alloc] initWithFrame:CGRectMake(0, 0, 300, 200)];
        menu.center = self.center;
        menu.hidden = YES;
        [self addSubview:menu];
        
        // Add gesture to toggle menu (e.g., 3-finger tap)
        UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(toggleMenu)];
        tap.numberOfTouchesRequired = 3;
        [self addGestureRecognizer:tap];
    }
}

%new
- (void)toggleMenu {
    isMenuVisible = !isMenuVisible;
    menu.hidden = !isMenuVisible;
}
%end

%hook GameController
- (void)update {
    %orig;
    
    if (menu.aimbotSwitch.isOn) {
        // [self runAimbotLogic];
    }
    
    if (menu.espSwitch.isOn) {
        // [self drawESP];
    }
}
%end
